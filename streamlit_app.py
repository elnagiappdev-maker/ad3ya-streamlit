<same code from final version above>